<div class="container">
  <div class="row">
    <h1>Edit <%= @quiz.topic %> Quiz</h1>
  </div>

  <%= form_with model: @quiz, id: "quiz-form", local: true do |f| %>
    
    <!-- Quiz Topic -->
    <div class="form-group">
      <%= f.label :topic %>
      <%= f.text_field :topic, class: 'form-control' %>
    </div>

    <!-- Quiz Difficulty -->
    <div class="form-group">
      <%= f.label :difficulty %>
      <%= f.select :difficulty, Quiz.difficulties.keys.map { |w| [w.humanize, w] }, { include_blank: true }, class: 'form-control' %>
    </div>

    <!-- Study Duration -->
    <div class="form-group">
      <%= f.label :study_duration, "Study Duration (in minutes)" %>
      <%= f.number_field :study_duration, class: 'form-control', min: 1 %>
    </div>

    <!-- Detail Level -->
    <div class="form-group">
      <%= f.label :detail_level %>
      <%= f.select :detail_level, Quiz.detail_levels.keys.map { |w| [w.humanize, w] }, { include_blank: true }, class: 'form-control' %>
    </div>

    <!-- Questions Section -->
    <h3>Questions</h3>
    
    <%= f.fields_for :questions do |qf| %>
        <div class="question-fields mb-4">
            <!-- Question Content -->
            <div class="form-group">
            <%= qf.label :content, "Question Content" %>
            <%= qf.text_area :content, class: 'form-control' %>
            </div>

            <!-- Correct Answer -->
            <div class="form-group">
            <%= qf.label :correct_answer, "Correct Answer" %>
            <%= qf.text_field :correct_answer, class: 'form-control' %>
            </div>

            <!-- Options Section -->
            <div class="form-group">
            <%= qf.label :options, "Options (Comma-separated)" %>
            <%= qf.text_area :options, class: 'form-control new-op', placeholder: "Enter options as comma-separated values" %>
            </div>

            <% options = qf.object.options.scan(/"([^"]*)"/).flatten %>
            <% options.each_with_index do |pans, index| %>
            <div class="form-group">
                <%= qf.text_field :new_options, value: pans.strip, class: 'form-control new-options', placeholder: "Enter answer option..." %>
            </div>
            <% end %>
        </div>
    <% end %>

    <%= f.submit "Update Quiz", class: 'btn btn-primary' %>
  <% end %>

  <div class="mt-3">
    <%= link_to "Back to Quiz", quiz_path(@quiz), class: "btn btn-secondary" %>
  </div>
</div>

<!-- Additional Styling -->
<style>
  .form-control {
    font-size: 1rem;
  }
  .btn-primary {
    padding: 0.8rem 2rem;
    font-size: 1.2rem;
  }
  .btn-secondary {
    font-size: 1rem;
    padding: 0.6rem 1.8rem;
  }
  h3 {
    margin-top: 1.5rem;
  }
  .question-fields {
    border: 1px solid #ddd;
    padding: 1rem;
    border-radius: 5px;
    background-color: #f9f9f9;
  }
  .option-input {
    margin-bottom: 10px;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const quizForm = document.getElementById("quiz-form");

    if (quizForm) {
      quizForm.addEventListener("submit", (event) => {
        event.preventDefault();

        const questionFields = document.querySelectorAll(".question-fields");
        const optionsDictionary = {};

        // Build the options dictionary
        questionFields.forEach((questionField, index) => {
          const newOptionsFields = questionField.querySelectorAll(".new-options");
          const optionsArray = Array.from(newOptionsFields).map(field => field.value.trim());

          optionsDictionary[index] = optionsArray;

          // Replace the value of the :options text field with the JSON stringified array
          const optionsTextField = questionField.querySelector("textarea.new-op");
          if (optionsTextField) {
            optionsTextField.value = JSON.stringify(optionsArray);
          }
        });

        console.log("Options Dictionary:", optionsDictionary);

        // Comment to check console to see if its working 
        quizForm.submit();
      });
    } else {
      console.error("Quiz form not found.");
    }
  });
</script>






